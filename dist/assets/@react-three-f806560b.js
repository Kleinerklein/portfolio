import{_ as de}from"./@babel-34ca84e8.js";import{r as g}from"./react-28e27bf8.js";import{L as Pe,T as jt,R as Rt,U as kt,s as nt,a as At,O as ze,P as Ie,S as Ve,b as Me,B as Dt,M as Lt,C as Ft,V as U,c as zt,W as It,d as Ht,e as Wt,f as $t,g as Bt,h as Nt,N as qt,A as Gt,i as Ut,j as Vt,D as Xt,k as he,l as He,m as Yt,E as rt,n as Zt,o as Kt,p as Jt,q as Qt}from"./three-baf2c237.js";import{u as en}from"./react-use-measure-62ef25b6.js";import{F as tn,u as nn}from"./its-fine-874e5756.js";import{R as rn,c as se}from"./react-reconciler-639cd3ca.js";import{c as on}from"./react-dom-4d0f5c62.js";import{c as ot}from"./zustand-febf465b.js";import{D as sn,G as We,a as an,M as Ce,O as ln}from"./three-stdlib-b048649d.js";import{m as cn}from"./react-merge-refs-239dbb3c.js";import{s as un,p as fn,c as dn}from"./suspend-react-00b64780.js";var we={},pn={get exports(){return we},set exports(e){we=e}},it={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(w,x){var C=w.length;w.push(x);e:for(;0<C;){var T=C-1>>>1,O=w[T];if(0<s(O,x))w[T]=x,w[C]=O,C=T;else break e}}function r(w){return w.length===0?null:w[0]}function i(w){if(w.length===0)return null;var x=w[0],C=w.pop();if(C!==x){w[0]=C;e:for(var T=0,O=w.length,W=O>>>1;T<W;){var L=2*(T+1)-1,V=w[L],B=L+1,te=w[B];if(0>s(V,C))B<O&&0>s(te,V)?(w[T]=te,w[B]=C,T=B):(w[T]=V,w[L]=C,T=L);else if(B<O&&0>s(te,C))w[T]=te,w[B]=C,T=B;else break e}}return x}function s(w,x){var C=w.sortIndex-x.sortIndex;return C!==0?C:w.id-x.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;e.unstable_now=function(){return u.now()}}else{var h=Date,v=h.now();e.unstable_now=function(){return h.now()-v}}var a=[],p=[],o=1,n=null,c=3,d=!1,m=!1,P=!1,y=typeof setTimeout=="function"?setTimeout:null,l=typeof clearTimeout=="function"?clearTimeout:null,f=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(w){for(var x=r(p);x!==null;){if(x.callback===null)i(p);else if(x.startTime<=w)i(p),x.sortIndex=x.expirationTime,t(a,x);else break;x=r(p)}}function E(w){if(P=!1,b(w),!m)if(r(a)!==null)m=!0,G(M);else{var x=r(p);x!==null&&F(E,x.startTime-w)}}function M(w,x){m=!1,P&&(P=!1,l(R),R=-1),d=!0;var C=c;try{for(b(x),n=r(a);n!==null&&(!(n.expirationTime>x)||w&&!_());){var T=n.callback;if(typeof T=="function"){n.callback=null,c=n.priorityLevel;var O=T(n.expirationTime<=x);x=e.unstable_now(),typeof O=="function"?n.callback=O:n===r(a)&&i(a),b(x)}else i(a);n=r(a)}if(n!==null)var W=!0;else{var L=r(p);L!==null&&F(E,L.startTime-x),W=!1}return W}finally{n=null,c=C,d=!1}}var S=!1,A=null,R=-1,j=5,D=-1;function _(){return!(e.unstable_now()-D<j)}function k(){if(A!==null){var w=e.unstable_now();D=w;var x=!0;try{x=A(!0,w)}finally{x?$():(S=!1,A=null)}}else S=!1}var $;if(typeof f=="function")$=function(){f(k)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,H=X.port2;X.port1.onmessage=k,$=function(){H.postMessage(null)}}else $=function(){y(k,0)};function G(w){A=w,S||(S=!0,$())}function F(w,x){R=y(function(){w(e.unstable_now())},x)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(w){w.callback=null},e.unstable_continueExecution=function(){m||d||(m=!0,G(M))},e.unstable_forceFrameRate=function(w){0>w||125<w?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<w?Math.floor(1e3/w):5},e.unstable_getCurrentPriorityLevel=function(){return c},e.unstable_getFirstCallbackNode=function(){return r(a)},e.unstable_next=function(w){switch(c){case 1:case 2:case 3:var x=3;break;default:x=c}var C=c;c=x;try{return w()}finally{c=C}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(w,x){switch(w){case 1:case 2:case 3:case 4:case 5:break;default:w=3}var C=c;c=w;try{return x()}finally{c=C}},e.unstable_scheduleCallback=function(w,x,C){var T=e.unstable_now();switch(typeof C=="object"&&C!==null?(C=C.delay,C=typeof C=="number"&&0<C?T+C:T):C=T,w){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=C+O,w={id:o++,callback:x,priorityLevel:w,startTime:C,expirationTime:O,sortIndex:-1},C>T?(w.sortIndex=C,t(p,w),r(a)===null&&w===r(p)&&(P?(l(R),R=-1):P=!0,F(E,C-T))):(w.sortIndex=O,t(a,w),m||d||(m=!0,G(M))),w},e.unstable_shouldYield=_,e.unstable_wrapCallback=function(w){var x=c;return function(){var C=c;c=x;try{return w.apply(this,arguments)}finally{c=C}}}})(it);(function(e){e.exports=it})(pn);const $e={},mn=e=>void Object.assign($e,e);function vn(e,t){function r(o,{args:n=[],attach:c,...d},m){let P=`${o[0].toUpperCase()}${o.slice(1)}`,y;if(o==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const l=d.object;y=oe(l,{type:o,root:m,attach:c,primitive:!0})}else{const l=$e[P];if(!l)throw new Error(`R3F: ${P} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(n))throw new Error("R3F: The args prop must be an array!");y=oe(new l(...n),{type:o,root:m,attach:c,memoizedProps:{args:n}})}return y.__r3f.attach===void 0&&(y instanceof Dt?y.__r3f.attach="geometry":y instanceof Lt&&(y.__r3f.attach="material")),P!=="inject"&&Se(y,d),y}function i(o,n){let c=!1;if(n){var d,m;(d=n.__r3f)!=null&&d.attach?xe(o,n,n.__r3f.attach):n.isObject3D&&o.isObject3D&&(o.add(n),c=!0),c||(m=o.__r3f)==null||m.objects.push(n),n.__r3f||oe(n,{}),n.__r3f.parent=o,Le(n),ie(n)}}function s(o,n,c){let d=!1;if(n){var m,P;if((m=n.__r3f)!=null&&m.attach)xe(o,n,n.__r3f.attach);else if(n.isObject3D&&o.isObject3D){n.parent=o,n.dispatchEvent({type:"added"});const y=o.children.filter(f=>f!==n),l=y.indexOf(c);o.children=[...y.slice(0,l),n,...y.slice(l)],d=!0}d||(P=o.__r3f)==null||P.objects.push(n),n.__r3f||oe(n,{}),n.__r3f.parent=o,Le(n),ie(n)}}function u(o,n,c=!1){o&&[...o].forEach(d=>h(n,d,c))}function h(o,n,c){if(n){var d,m,P;if(n.__r3f&&(n.__r3f.parent=null),(d=o.__r3f)!=null&&d.objects&&(o.__r3f.objects=o.__r3f.objects.filter(E=>E!==n)),(m=n.__r3f)!=null&&m.attach)Je(o,n,n.__r3f.attach);else if(n.isObject3D&&o.isObject3D){var y;o.remove(n),(y=n.__r3f)!=null&&y.root&&Pn(n.__r3f.root,n)}const f=(P=n.__r3f)==null?void 0:P.primitive,b=c===void 0?n.dispose!==null&&!f:c;if(!f){var l;u((l=n.__r3f)==null?void 0:l.objects,n,b),u(n.children,n,b)}n.__r3f&&(delete n.__r3f.root,delete n.__r3f.objects,delete n.__r3f.handlers,delete n.__r3f.memoizedProps,f||delete n.__r3f),b&&n.dispose&&n.type!=="Scene"&&we.unstable_scheduleCallback(we.unstable_IdlePriority,()=>{try{n.dispose()}catch{}}),ie(o)}}function v(o,n,c,d){var m;const P=(m=o.__r3f)==null?void 0:m.parent;if(!P)return;const y=r(n,c,o.__r3f.root);if(o.children){for(const l of o.children)l.__r3f&&i(y,l);o.children=o.children.filter(l=>!l.__r3f)}o.__r3f.objects.forEach(l=>i(y,l)),o.__r3f.objects=[],o.__r3f.autoRemovedBeforeAppend||h(P,o),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),i(P,y),y.raycast&&y.__r3f.eventCount&&y.__r3f.root.getState().internal.interaction.push(y),[d,d.alternate].forEach(l=>{l!==null&&(l.stateNode=y,l.ref&&(typeof l.ref=="function"?l.ref(y):l.ref.current=y))})}const a=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:rn({createInstance:r,removeChild:h,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(o,n)=>{if(!n)return;const c=o.getState().scene;c.__r3f&&(c.__r3f.root=o,i(c,n))},removeChildFromContainer:(o,n)=>{n&&h(o.getState().scene,n)},insertInContainerBefore:(o,n,c)=>{if(!n||!c)return;const d=o.getState().scene;d.__r3f&&s(d,n,c)},getRootHostContext:()=>null,getChildHostContext:o=>o,finalizeInitialChildren(o){var n;return!!((n=o==null?void 0:o.__r3f)!=null?n:{}).handlers},prepareUpdate(o,n,c,d){if(o.__r3f.primitive&&d.object&&d.object!==o)return[!0];{const{args:m=[],children:P,...y}=d,{args:l=[],children:f,...b}=c;if(!Array.isArray(m))throw new Error("R3F: the args prop must be an array!");if(m.some((M,S)=>M!==l[S]))return[!0];const E=dt(o,y,b,!0);return E.changes.length?[!1,E]:null}},commitUpdate(o,[n,c],d,m,P,y){n?v(o,d,P,y):Se(o,c)},commitMount(o,n,c,d){var m;const P=(m=o.__r3f)!=null?m:{};o.raycast&&P.handlers&&P.eventCount&&o.__r3f.root.getState().internal.interaction.push(o)},getPublicInstance:o=>o,prepareForCommit:()=>null,preparePortalMount:o=>oe(o.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(o){var n;const{attach:c,parent:d}=(n=o.__r3f)!=null?n:{};c&&d&&Je(d,o,c),o.isObject3D&&(o.visible=!1),ie(o)},unhideInstance(o,n){var c;const{attach:d,parent:m}=(c=o.__r3f)!=null?c:{};d&&m&&xe(m,o,d),(o.isObject3D&&n.visible==null||n.visible)&&(o.visible=!0),ie(o)},createTextInstance:a,hideTextInstance:a,unhideTextInstance:a,getCurrentEventPriority:()=>t?t():se.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&I.fun(performance.now)?performance.now:I.fun(Date.now)?Date.now:()=>0,scheduleTimeout:I.fun(setTimeout)?setTimeout:void 0,cancelTimeout:I.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Se}}var Xe,Ye;const st=()=>{var e;return(e=$e.ColorManagement)!=null?e:null},at=e=>e&&e.isOrthographicCamera,hn=e=>e&&e.hasOwnProperty("current"),pe=typeof window<"u"&&((Xe=window.document)!=null&&Xe.createElement||((Ye=window.navigator)==null?void 0:Ye.product)==="ReactNative")?g.useLayoutEffect:g.useEffect;function lt(e){const t=g.useRef(e);return pe(()=>void(t.current=e),[e]),t}function gn({set:e}){return pe(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class ct extends g.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}ct.getDerivedStateFromError=()=>({error:!0});const ut="__default",Ze=new Map,yn=e=>e&&!!e.memoized&&!!e.changes;function ft(e){const t=typeof window<"u"?window.devicePixelRatio:1;return Array.isArray(e)?Math.min(Math.max(e[0],t),e[1]):e}const ce=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},I={obj:e=>e===Object(e)&&!I.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(I.str(e)||I.num(e))return e===t;const u=I.obj(e);if(u&&i==="reference")return e===t;const h=I.arr(e);if(h&&r==="reference")return e===t;if((h||u)&&e===t)return!0;let v;for(v in e)if(!(v in t))return!1;if(u&&r==="shallow"&&i==="shallow"){for(v in s?t:e)if(!I.equ(e[v],t[v],{strict:s,objects:"reference"}))return!1}else for(v in s?t:e)if(e[v]!==t[v])return!1;if(I.und(v)){if(h&&e.length===0&&t.length===0||u&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function bn(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function wn(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function oe(e,t){const r=e;return(t!=null&&t.primitive||!r.__r3f)&&(r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}function De(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),s=i.pop();return r=i.reduce((u,h)=>u[h],e),{target:r,key:s}}else return{target:r,key:t}}const Ke=/-\d+$/;function xe(e,t,r){if(I.str(r)){if(Ke.test(r)){const u=r.replace(Ke,""),{target:h,key:v}=De(e,u);Array.isArray(h[v])||(h[v]=[])}const{target:i,key:s}=De(e,r);t.__r3f.previousAttach=i[s],i[s]=t}else t.__r3f.previousAttach=r(e,t)}function Je(e,t,r){var i,s;if(I.str(r)){const{target:u,key:h}=De(e,r),v=t.__r3f.previousAttach;v===void 0?delete u[h]:u[h]=v}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function dt(e,{children:t,key:r,ref:i,...s},{children:u,key:h,ref:v,...a}={},p=!1){var o;const n=(o=e==null?void 0:e.__r3f)!=null?o:{},c=Object.entries(s),d=[];if(p){const P=Object.keys(a);for(let y=0;y<P.length;y++)s.hasOwnProperty(P[y])||c.unshift([P[y],ut+"remove"])}c.forEach(([P,y])=>{var l;if((l=e.__r3f)!=null&&l.primitive&&P==="object"||I.equ(y,a[P]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(P))return d.push([P,y,!0,[]]);let f=[];P.includes("-")&&(f=P.split("-")),d.push([P,y,!1,f]);for(const b in s){const E=s[b];b.startsWith(`${P}-`)&&d.push([b,E,!1,b.split("-")])}});const m={...s};return n.memoizedProps&&n.memoizedProps.args&&(m.args=n.memoizedProps.args),n.memoizedProps&&n.memoizedProps.attach&&(m.attach=n.memoizedProps.attach),{memoized:m,changes:d}}function Se(e,t){var r,i,s;const u=(r=e.__r3f)!=null?r:{},h=u.root,v=(i=h==null||h.getState==null?void 0:h.getState())!=null?i:{},{memoized:a,changes:p}=yn(t)?t:dt(e,t),o=u.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let c=0;c<p.length;c++){let[d,m,P,y]=p[c],l=e,f=l[d];if(y.length&&(f=y.reduce((b,E)=>b[E],e),!(f&&f.set))){const[b,...E]=y.reverse();l=E.reverse().reduce((M,S)=>M[S],e),d=b}if(m===ut+"remove")if(l.constructor){let b=Ze.get(l.constructor);b||(b=new l.constructor,Ze.set(l.constructor,b)),m=b[d]}else m=0;if(P)m?u.handlers[d]=m:delete u.handlers[d],u.eventCount=Object.keys(u.handlers).length;else if(f&&f.set&&(f.copy||f instanceof Pe)){if(Array.isArray(m))f.fromArray?f.fromArray(m):f.set(...m);else if(f.copy&&m&&m.constructor&&f.constructor===m.constructor)f.copy(m);else if(m!==void 0){const b=f instanceof Ft;!b&&f.setScalar?f.setScalar(m):f instanceof Pe&&m instanceof Pe?f.mask=m.mask:f.set(m),!st()&&!v.linear&&b&&f.convertSRGBToLinear()}}else l[d]=m,!v.linear&&l[d]instanceof jt&&l[d].format===Rt&&l[d].type===kt&&(l[d].encoding=nt);ie(e)}if(u.parent&&v.internal&&e.raycast&&o!==u.eventCount){const c=v.internal.interaction.indexOf(e);c>-1&&v.internal.interaction.splice(c,1),u.eventCount&&v.internal.interaction.push(e)}return!(p.length===1&&p[0][0]==="onUpdate")&&p.length&&(s=e.__r3f)!=null&&s.parent&&Le(e),e}function ie(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function Le(e){e.onUpdate==null||e.onUpdate(e)}function _n(e,t){e.manual||(at(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ge(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function En(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return se.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return se.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return se.ContinuousEventPriority;default:return se.DefaultEventPriority}}function pt(e,t,r,i){const s=r.get(t);s&&(r.delete(t),r.size===0&&(e.delete(i),s.target.releasePointerCapture(i)))}function Pn(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,s)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(s)}),r.capturedMap.forEach((i,s)=>{pt(r.capturedMap,t,i,s)})}function Mn(e){function t(a){const{internal:p}=e.getState(),o=a.offsetX-p.initialClick[0],n=a.offsetY-p.initialClick[1];return Math.round(Math.sqrt(o*o+n*n))}function r(a){return a.filter(p=>["Move","Over","Enter","Out","Leave"].some(o=>{var n;return(n=p.__r3f)==null?void 0:n.handlers["onPointer"+o]}))}function i(a,p){const o=e.getState(),n=new Set,c=[],d=p?p(o.internal.interaction):o.internal.interaction;for(let l=0;l<d.length;l++){const f=ce(d[l]);f&&(f.raycaster.camera=void 0)}o.previousRoot||o.events.compute==null||o.events.compute(a,o);function m(l){const f=ce(l);if(!f||!f.events.enabled||f.raycaster.camera===null)return[];if(f.raycaster.camera===void 0){var b;f.events.compute==null||f.events.compute(a,f,(b=f.previousRoot)==null?void 0:b.getState()),f.raycaster.camera===void 0&&(f.raycaster.camera=null)}return f.raycaster.camera?f.raycaster.intersectObject(l,!0):[]}let P=d.flatMap(m).sort((l,f)=>{const b=ce(l.object),E=ce(f.object);return!b||!E?l.distance-f.distance:E.events.priority-b.events.priority||l.distance-f.distance}).filter(l=>{const f=ge(l);return n.has(f)?!1:(n.add(f),!0)});o.events.filter&&(P=o.events.filter(P,o));for(const l of P){let f=l.object;for(;f;){var y;(y=f.__r3f)!=null&&y.eventCount&&c.push({...l,eventObject:f}),f=f.parent}}if("pointerId"in a&&o.internal.capturedMap.has(a.pointerId))for(let l of o.internal.capturedMap.get(a.pointerId).values())n.has(ge(l.intersection))||c.push(l.intersection);return c}function s(a,p,o,n){const c=e.getState();if(a.length){const d={stopped:!1};for(const m of a){const P=ce(m.object)||c,{raycaster:y,pointer:l,camera:f,internal:b}=P,E=new U(l.x,l.y,0).unproject(f),M=D=>{var _,k;return(_=(k=b.capturedMap.get(D))==null?void 0:k.has(m.eventObject))!=null?_:!1},S=D=>{const _={intersection:m,target:p.target};b.capturedMap.has(D)?b.capturedMap.get(D).set(m.eventObject,_):b.capturedMap.set(D,new Map([[m.eventObject,_]])),p.target.setPointerCapture(D)},A=D=>{const _=b.capturedMap.get(D);_&&pt(b.capturedMap,m.eventObject,_,D)};let R={};for(let D in p){let _=p[D];typeof _!="function"&&(R[D]=_)}let j={...m,...R,pointer:l,intersections:a,stopped:d.stopped,delta:o,unprojectedPoint:E,ray:y.ray,camera:f,stopPropagation(){const D="pointerId"in p&&b.capturedMap.get(p.pointerId);if((!D||D.has(m.eventObject))&&(j.stopped=d.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(_=>_.eventObject===m.eventObject))){const _=a.slice(0,a.indexOf(m));u([..._,m])}},target:{hasPointerCapture:M,setPointerCapture:S,releasePointerCapture:A},currentTarget:{hasPointerCapture:M,setPointerCapture:S,releasePointerCapture:A},nativeEvent:p};if(n(j),d.stopped===!0)break}}return a}function u(a){const{internal:p}=e.getState();for(const o of p.hovered.values())if(!a.length||!a.find(n=>n.object===o.object&&n.index===o.index&&n.instanceId===o.instanceId)){const c=o.eventObject.__r3f,d=c==null?void 0:c.handlers;if(p.hovered.delete(ge(o)),c!=null&&c.eventCount){const m={...o,intersections:a};d.onPointerOut==null||d.onPointerOut(m),d.onPointerLeave==null||d.onPointerLeave(m)}}}function h(a,p){for(let o=0;o<p.length;o++){const n=p[o].__r3f;n==null||n.handlers.onPointerMissed==null||n.handlers.onPointerMissed(a)}}function v(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>u([]);case"onLostPointerCapture":return p=>{const{internal:o}=e.getState();"pointerId"in p&&o.capturedMap.has(p.pointerId)&&requestAnimationFrame(()=>{o.capturedMap.has(p.pointerId)&&(o.capturedMap.delete(p.pointerId),u([]))})}}return function(o){const{onPointerMissed:n,internal:c}=e.getState();c.lastEvent.current=o;const d=a==="onPointerMove",m=a==="onClick"||a==="onContextMenu"||a==="onDoubleClick",y=i(o,d?r:void 0),l=m?t(o):0;a==="onPointerDown"&&(c.initialClick=[o.offsetX,o.offsetY],c.initialHits=y.map(b=>b.eventObject)),m&&!y.length&&l<=2&&(h(o,c.interaction),n&&n(o)),d&&u(y);function f(b){const E=b.eventObject,M=E.__r3f,S=M==null?void 0:M.handlers;if(M!=null&&M.eventCount)if(d){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const A=ge(b),R=c.hovered.get(A);R?R.stopped&&b.stopPropagation():(c.hovered.set(A,b),S.onPointerOver==null||S.onPointerOver(b),S.onPointerEnter==null||S.onPointerEnter(b))}S.onPointerMove==null||S.onPointerMove(b)}else{const A=S[a];A?(!m||c.initialHits.includes(E))&&(h(o,c.interaction.filter(R=>!c.initialHits.includes(R))),A(b)):m&&c.initialHits.includes(E)&&h(o,c.interaction.filter(R=>!c.initialHits.includes(R)))}}s(y,o,l,f)}}return{handlePointer:v}}const mt=e=>!!(e!=null&&e.render),vt=g.createContext(null),Cn=(e,t)=>{const r=ot((v,a)=>{const p=new U,o=new U,n=new U;function c(l=a().camera,f=o,b=a().size){const{width:E,height:M,top:S,left:A}=b,R=E/M;f instanceof U?n.copy(f):n.set(...f);const j=l.getWorldPosition(p).distanceTo(n);if(at(l))return{width:E/l.zoom,height:M/l.zoom,top:S,left:A,factor:1,distance:j,aspect:R};{const D=l.fov*Math.PI/180,_=2*Math.tan(D/2)*j,k=_*(E/M);return{width:k,height:_,top:S,left:A,factor:E/k,distance:j,aspect:R}}}let d;const m=l=>v(f=>({performance:{...f.performance,current:l}})),P=new zt;return{set:v,get:a,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(l=1)=>e(a(),l),advance:(l,f)=>t(l,f,a()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Ut,pointer:P,mouse:P,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=a();d&&clearTimeout(d),l.performance.current!==l.performance.min&&m(l.performance.min),d=setTimeout(()=>m(a().performance.max),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:c},setEvents:l=>v(f=>({...f,events:{...f.events,...l}})),setSize:(l,f,b,E,M)=>{const S=a().camera,A={width:l,height:f,top:E||0,left:M||0,updateStyle:b};v(R=>({size:A,viewport:{...R.viewport,...c(S,o,A)}}))},setDpr:l=>v(f=>{const b=ft(l);return{viewport:{...f.viewport,dpr:b,initialDpr:f.viewport.initialDpr||b}}}),setFrameloop:(l="always")=>{const f=a().clock;f.stop(),f.elapsedTime=0,l!=="never"&&(f.start(),f.elapsedTime=0),v(()=>({frameloop:l}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:g.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,f,b)=>{const E=a().internal;return E.priority=E.priority+(f>0?1:0),E.subscribers.push({ref:l,priority:f,store:b}),E.subscribers=E.subscribers.sort((M,S)=>M.priority-S.priority),()=>{const M=a().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(f>0?1:0),M.subscribers=M.subscribers.filter(S=>S.ref!==l))}}}}}),i=r.getState();let s=i.size,u=i.viewport.dpr,h=i.camera;return r.subscribe(()=>{const{camera:v,size:a,viewport:p,gl:o,set:n}=r.getState();if(a!==s||p.dpr!==u){var c;s=a,u=p.dpr,_n(v,a),o.setPixelRatio(p.dpr);const d=(c=a.updateStyle)!=null?c:typeof HTMLCanvasElement<"u"&&o.domElement instanceof HTMLCanvasElement;o.setSize(a.width,a.height,d)}v!==h&&(h=v,n(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(v)}})))}),r.subscribe(v=>e(v)),r};let ye,xn=new Set,Sn=new Set,On=new Set;function Oe(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function ue(e,t){switch(e){case"before":return Oe(xn,t);case"after":return Oe(Sn,t);case"tail":return Oe(On,t)}}let Te,je;function Re(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Te=t.internal.subscribers,ye=0;ye<Te.length;ye++)je=Te[ye],je.ref.current(je.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Tn(e){let t=!1,r,i,s;function u(a){i=requestAnimationFrame(u),t=!0,r=0,ue("before",a);for(const o of e.values()){var p;s=o.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((p=s.gl.xr)!=null&&p.isPresenting)&&(r+=Re(a,s))}if(ue("after",a),r===0)return ue("tail",a),t=!1,cancelAnimationFrame(i)}function h(a,p=1){var o;if(!a)return e.forEach(n=>h(n.store.getState()),p);(o=a.gl.xr)!=null&&o.isPresenting||!a.internal.active||a.frameloop==="never"||(a.internal.frames=Math.min(60,a.internal.frames+p),t||(t=!0,requestAnimationFrame(u)))}function v(a,p=!0,o,n){if(p&&ue("before",a),o)Re(a,o,n);else for(const c of e.values())Re(a,c.store.getState());p&&ue("after",a)}return{loop:u,invalidate:h,advance:v}}function ht(){const e=g.useContext(vt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function q(e=r=>r,t){return ht()(e,t)}function Be(e,t=0){const r=ht(),i=r.getState().internal.subscribe,s=lt(e);return pe(()=>i(s,t,r),[t,i,r]),null}function gt(e,t){return function(r,...i){const s=new r;return e&&e(s),Promise.all(i.map(u=>new Promise((h,v)=>s.load(u,a=>{a.scene&&Object.assign(a,bn(a.scene)),h(a)},t,a=>v(new Error(`Could not load ${u}: ${a.message})`))))))}}function K(e,t,r,i){const s=Array.isArray(t)?t:[t],u=un(gt(r,i),[e,...s],{equal:I.equ});return Array.isArray(t)?u:u[0]}K.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return fn(gt(r),[e,...i])};K.clear=function(e,t){const r=Array.isArray(t)?t:[t];return dn([e,...r])};const ae=new Map,{invalidate:Qe,advance:et}=Tn(ae),{reconciler:_e,applyProps:Z}=vn(ae,En),re={objects:"shallow",strict:!1},jn=(e,t)=>{const r=typeof e=="function"?e(t):e;return mt(r)?r:new It({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Rn(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:r,height:i,top:s,left:u}=e.parentElement.getBoundingClientRect();return{width:r,height:i,top:s,left:u}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function kn(e){const t=ae.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,u=i||Cn(Qe,et),h=r||_e.createContainer(u,se.ConcurrentRoot,null,!1,null,"",s,null);t||ae.set(e,{fiber:h,store:u});let v,a=!1,p;return{configure(o={}){let{gl:n,size:c,scene:d,events:m,onCreated:P,shadows:y=!1,linear:l=!1,flat:f=!1,legacy:b=!1,orthographic:E=!1,frameloop:M="always",dpr:S=[1,2],performance:A,raycaster:R,camera:j,onPointerMissed:D}=o,_=u.getState(),k=_.gl;_.gl||_.set({gl:k=jn(n,e)});let $=_.raycaster;$||_.set({raycaster:$=new At});const{params:X,...H}=R||{};if(I.equ(H,$,re)||Z($,{...H}),I.equ(X,$.params,re)||Z($,{params:{...$.params,...X}}),!_.camera||_.camera===p&&!I.equ(p,j,re)){p=j;const T=j instanceof Ht,O=T?j:E?new ze(0,0,0,0,.1,1e3):new Ie(75,0,.1,1e3);T||(O.position.z=5,j&&Z(O,j),!_.camera&&!(j!=null&&j.rotation)&&O.lookAt(0,0,0)),_.set({camera:O})}if(!_.scene){let T;d instanceof Ve?T=d:(T=new Ve,d&&Z(T,d)),_.set({scene:oe(T)})}if(!_.xr){const T=(L,V)=>{const B=u.getState();B.frameloop!=="never"&&et(L,!0,B,V)},O=()=>{const L=u.getState();L.gl.xr.enabled=L.gl.xr.isPresenting,L.gl.xr.setAnimationLoop(L.gl.xr.isPresenting?T:null),L.gl.xr.isPresenting||Qe(L)},W={connect(){const L=u.getState().gl;L.xr.addEventListener("sessionstart",O),L.xr.addEventListener("sessionend",O)},disconnect(){const L=u.getState().gl;L.xr.removeEventListener("sessionstart",O),L.xr.removeEventListener("sessionend",O)}};k.xr&&W.connect(),_.set({xr:W})}if(k.shadowMap){const T=k.shadowMap.enabled,O=k.shadowMap.type;if(k.shadowMap.enabled=!!y,I.boo(y))k.shadowMap.type=Me;else if(I.str(y)){var G;const W={basic:Wt,percentage:$t,soft:Me,variance:Bt};k.shadowMap.type=(G=W[y])!=null?G:Me}else I.obj(y)&&Object.assign(k.shadowMap,y);(T!==k.shadowMap.enabled||O!==k.shadowMap.type)&&(k.shadowMap.needsUpdate=!0)}const F=st();F&&("enabled"in F?F.enabled=!b:"legacyMode"in F&&(F.legacyMode=b));const w=l?Nt:nt,x=f?qt:Gt;k.outputEncoding!==w&&(k.outputEncoding=w),k.toneMapping!==x&&(k.toneMapping=x),_.legacy!==b&&_.set(()=>({legacy:b})),_.linear!==l&&_.set(()=>({linear:l})),_.flat!==f&&_.set(()=>({flat:f})),n&&!I.fun(n)&&!mt(n)&&!I.equ(n,k,re)&&Z(k,n),m&&!_.events.handlers&&_.set({events:m(u)});const C=Rn(e,c);return I.equ(C,_.size,re)||_.setSize(C.width,C.height,C.updateStyle,C.top,C.left),S&&_.viewport.dpr!==ft(S)&&_.setDpr(S),_.frameloop!==M&&_.setFrameloop(M),_.onPointerMissed||_.set({onPointerMissed:D}),A&&!I.equ(A,_.performance,re)&&_.set(T=>({performance:{...T.performance,...A}})),v=P,a=!0,this},render(o){return a||this.configure(),_e.updateContainer(g.createElement(An,{store:u,children:o,onCreated:v,rootElement:e}),h,null,()=>{}),u},unmount(){yt(e)}}}function An({store:e,children:t,onCreated:r,rootElement:i}){return pe(()=>{const s=e.getState();s.set(u=>({internal:{...u.internal,active:!0}})),r&&r(s),e.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),g.createElement(vt.Provider,{value:e},t)}function yt(e,t){const r=ae.get(e),i=r==null?void 0:r.fiber;if(i){const s=r==null?void 0:r.store.getState();s&&(s.internal.active=!1),_e.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var u,h,v,a;s.events.disconnect==null||s.events.disconnect(),(u=s.gl)==null||(h=u.renderLists)==null||h.dispose==null||h.dispose(),(v=s.gl)==null||v.forceContextLoss==null||v.forceContextLoss(),(a=s.gl)!=null&&a.xr&&s.xr.disconnect(),wn(s),ae.delete(e),t&&t(e)}catch{}},500)})}}_e.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:g.version});const ke={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Dn(e){const{handlePointer:t}=Mn(e);return{priority:1,enabled:!0,compute(r,i,s){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(ke).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:s}=e.getState();(r=s.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:r=>{var i;const{set:s,events:u}=e.getState();u.disconnect==null||u.disconnect(),s(h=>({events:{...h.events,connected:r}})),Object.entries((i=u.handlers)!=null?i:[]).forEach(([h,v])=>{const[a,p]=ke[h];r.addEventListener(a,v,{passive:p})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([u,h])=>{if(i&&i.connected instanceof HTMLElement){const[v]=ke[u];i.connected.removeEventListener(v,h)}}),r(u=>({events:{...u.events,connected:void 0}}))}}}}const Ln=g.forwardRef(function({children:t,fallback:r,resize:i,style:s,gl:u,events:h=Dn,eventSource:v,eventPrefix:a,shadows:p,linear:o,flat:n,legacy:c,orthographic:d,frameloop:m,dpr:P,performance:y,raycaster:l,camera:f,onPointerMissed:b,onCreated:E,...M},S){g.useMemo(()=>mn(Vt),[]);const A=nn(),[R,j]=en({scroll:!0,debounce:{scroll:50,resize:0},...i}),D=g.useRef(null),_=g.useRef(null);g.useImperativeHandle(S,()=>D.current);const k=lt(b),[$,X]=g.useState(!1),[H,G]=g.useState(!1);if($)throw $;if(H)throw H;const F=g.useRef(null);pe(()=>{const x=D.current;j.width>0&&j.height>0&&x&&(F.current||(F.current=kn(x)),F.current.configure({gl:u,events:h,shadows:p,linear:o,flat:n,legacy:c,orthographic:d,frameloop:m,dpr:P,performance:y,raycaster:l,camera:f,size:j,onPointerMissed:(...C)=>k.current==null?void 0:k.current(...C),onCreated:C=>{C.events.connect==null||C.events.connect(v?hn(v)?v.current:v:_.current),a&&C.setEvents({compute:(T,O)=>{const W=T[a+"X"],L=T[a+"Y"];O.pointer.set(W/O.size.width*2-1,-(L/O.size.height)*2+1),O.raycaster.setFromCamera(O.pointer,O.camera)}}),E==null||E(C)}}),F.current.render(g.createElement(A,null,g.createElement(ct,{set:G},g.createElement(g.Suspense,{fallback:g.createElement(gn,{set:X})},t)))))}),g.useEffect(()=>{const x=D.current;if(x)return()=>yt(x)},[]);const w=v?"none":"auto";return g.createElement("div",de({ref:_,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:w,...s}},M),g.createElement("div",{ref:R,style:{width:"100%",height:"100%"}},g.createElement("canvas",{ref:D,style:{display:"block"}},r)))}),rr=g.forwardRef(function(t,r){return g.createElement(tn,null,g.createElement(Ln,de({},t,{ref:r})))}),me=new U,Ne=new U,Fn=new U;function zn(e,t,r){const i=me.setFromMatrixPosition(e.matrixWorld);i.project(t);const s=r.width/2,u=r.height/2;return[i.x*s+s,-(i.y*u)+u]}function In(e,t){const r=me.setFromMatrixPosition(e.matrixWorld),i=Ne.setFromMatrixPosition(t.matrixWorld),s=r.sub(i),u=t.getWorldDirection(Fn);return s.angleTo(u)>Math.PI/2}function Hn(e,t,r,i){const s=me.setFromMatrixPosition(e.matrixWorld),u=s.clone();u.project(t),r.setFromCamera(u,t);const h=r.intersectObjects(i,!0);if(h.length){const v=h[0].distance;return s.distanceTo(r.ray.origin)<v}return!0}function Wn(e,t){if(t instanceof ze)return t.zoom;if(t instanceof Ie){const r=me.setFromMatrixPosition(e.matrixWorld),i=Ne.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,u=r.distanceTo(i);return 1/(2*Math.tan(s/2)*u)}else return 1}function $n(e,t,r){if(t instanceof Ie||t instanceof ze){const i=me.setFromMatrixPosition(e.matrixWorld),s=Ne.setFromMatrixPosition(t.matrixWorld),u=i.distanceTo(s),h=(r[1]-r[0])/(t.far-t.near),v=r[1]-h*t.far;return Math.round(h*u+v)}}const Fe=e=>Math.abs(e)<1e-10?0:e;function bt(e,t,r=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=Fe(t[s]*e.elements[s])+(s!==15?",":")");return r+i}const Bn=(e=>t=>bt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Nn=(e=>(t,r)=>bt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function qn(e){return e&&typeof e=="object"&&"current"in e}const or=g.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:s,center:u,fullscreen:h,portal:v,distanceFactor:a,sprite:p=!1,transform:o=!1,occlude:n,onOcclude:c,castShadow:d,receiveShadow:m,material:P,geometry:y,zIndexRange:l=[16777271,0],calculatePosition:f=zn,as:b="div",wrapperClass:E,pointerEvents:M="auto",...S},A)=>{const{gl:R,camera:j,scene:D,size:_,raycaster:k,events:$,viewport:X}=q(),[H]=g.useState(()=>document.createElement(b)),G=g.useRef(),F=g.useRef(null),w=g.useRef(0),x=g.useRef([0,0]),C=g.useRef(null),T=g.useRef(null),O=(v==null?void 0:v.current)||$.connected||R.domElement.parentNode,W=g.useRef(null),L=g.useRef(!1),V=g.useMemo(()=>n&&n!=="blending"||Array.isArray(n)&&n.length&&qn(n[0]),[n]);g.useLayoutEffect(()=>{const N=R.domElement;n&&n==="blending"?(N.style.zIndex=`${Math.floor(l[0]/2)}`,N.style.position="absolute",N.style.pointerEvents="none"):(N.style.zIndex=null,N.style.position=null,N.style.pointerEvents=null)},[n]),g.useLayoutEffect(()=>{if(F.current){const N=G.current=on(H);if(D.updateMatrixWorld(),o)H.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const z=f(F.current,j,_);H.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${z[0]}px,${z[1]}px,0);transform-origin:0 0;`}return O&&(s?O.prepend(H):O.appendChild(H)),()=>{O&&O.removeChild(H),N.unmount()}}},[O,o]),g.useLayoutEffect(()=>{E&&(H.className=E)},[E]);const B=g.useMemo(()=>o?{position:"absolute",top:0,left:0,width:_.width,height:_.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:u?"translate3d(-50%,-50%,0)":"none",...h&&{top:-_.height/2,left:-_.width/2,width:_.width,height:_.height},...r},[r,u,h,_,o]),te=g.useMemo(()=>({position:"absolute",pointerEvents:M}),[M]);g.useLayoutEffect(()=>{if(L.current=!1,o){var N;(N=G.current)==null||N.render(g.createElement("div",{ref:C,style:B},g.createElement("div",{ref:T,style:te},g.createElement("div",{ref:A,className:i,style:r,children:e}))))}else{var z;(z=G.current)==null||z.render(g.createElement("div",{ref:A,style:B,className:i,children:e}))}});const ne=g.useRef(!0);Be(N=>{if(F.current){j.updateMatrixWorld(),F.current.updateWorldMatrix(!0,!1);const z=o?x.current:f(F.current,j,_);if(o||Math.abs(w.current-j.zoom)>t||Math.abs(x.current[0]-z[0])>t||Math.abs(x.current[1]-z[1])>t){const J=In(F.current,j);let Y=!1;V&&(n!=="blending"?Y=[D]:Array.isArray(n)&&(Y=n.map(Q=>Q.current)));const le=ne.current;if(Y){const Q=Hn(F.current,j,k,Y);ne.current=Q&&!J}else ne.current=!J;le!==ne.current&&(c?c(!ne.current):H.style.display=ne.current?"block":"none");const ve=Math.floor(l[0]/2),Pt=n?V?[l[0],ve]:[ve-1,0]:l;if(H.style.zIndex=`${$n(F.current,j,Pt)}`,o){const[Q,Ge]=[_.width/2,_.height/2],Ee=j.projectionMatrix.elements[5]*Ge,{isOrthographicCamera:Ue,top:Mt,left:Ct,bottom:xt,right:St}=j,Ot=Bn(j.matrixWorldInverse),Tt=Ue?`scale(${Ee})translate(${Fe(-(St+Ct)/2)}px,${Fe((Mt+xt)/2)}px)`:`translateZ(${Ee}px)`;let ee=F.current.matrixWorld;p&&(ee=j.matrixWorldInverse.clone().transpose().copyPosition(ee).scale(F.current.scale),ee.elements[3]=ee.elements[7]=ee.elements[11]=0,ee.elements[15]=1),H.style.width=_.width+"px",H.style.height=_.height+"px",H.style.perspective=Ue?"":`${Ee}px`,C.current&&T.current&&(C.current.style.transform=`${Tt}${Ot}translate(${Q}px,${Ge}px)`,T.current.style.transform=Nn(ee,1/((a||10)/400)))}else{const Q=a===void 0?1:Wn(F.current,j)*a;H.style.transform=`translate3d(${z[0]}px,${z[1]}px,0) scale(${Q})`}x.current=z,w.current=j.zoom}}if(!V&&W.current&&!L.current)if(o){if(C.current){const z=C.current.children[0];if(z!=null&&z.clientWidth&&z!=null&&z.clientHeight){const{isOrthographicCamera:J}=j;if(J||y)S.scale&&(Array.isArray(S.scale)?S.scale instanceof U?W.current.scale.copy(S.scale.clone().divideScalar(1)):W.current.scale.set(1/S.scale[0],1/S.scale[1],1/S.scale[2]):W.current.scale.setScalar(1/S.scale));else{const Y=(a||10)/400,le=z.clientWidth*Y,ve=z.clientHeight*Y;W.current.scale.set(le,ve,1)}L.current=!0}}}else{const z=H.children[0];if(z!=null&&z.clientWidth&&z!=null&&z.clientHeight){const J=1/X.factor,Y=z.clientWidth*J,le=z.clientHeight*J;W.current.scale.set(Y,le,1),L.current=!0}W.current.lookAt(N.camera.position)}});const qe=g.useMemo(()=>({vertexShader:o?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[o]);return g.createElement("group",de({},S,{ref:F}),n&&!V&&g.createElement("mesh",{castShadow:d,receiveShadow:m,ref:W},y||g.createElement("planeGeometry",null),P||g.createElement("shaderMaterial",{side:Xt,vertexShader:qe.vertexShader,fragmentShader:qe.fragmentShader})))});let fe=0;const ir=ot(e=>(he.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-fe)/(i-fe)*100})},he.onLoad=()=>{e({active:!1})},he.onError=t=>e(r=>({errors:[...r.errors,t]})),he.onProgress=(t,r,i)=>{r===i&&(fe=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-fe)/(i-fe)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),tt=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function wt(e,t){const r=q(s=>s.gl),i=K(He,tt(e)?Object.values(e):e);if(g.useLayoutEffect(()=>{t==null||t(i)},[t]),g.useEffect(()=>{(Array.isArray(i)?i:[i]).forEach(r.initTexture)},[r,i]),tt(e)){const s=Object.keys(e),u={};return s.forEach(h=>Object.assign(u,{[h]:i[s.indexOf(h)]})),u}else return i}wt.preload=e=>K.preload(He,e);wt.clear=e=>K.clear(He,e);function Gn(e){return Array.isArray(e)}function Ae(e=[0,0,0]){return Gn(e)?e:e instanceof U||e instanceof rt?[e.x,e.y,e.z]:[e,e,e]}function sr({debug:e,mesh:t,children:r,position:i,rotation:s,scale:u,...h}){const v=g.useRef(null),a=g.useRef(null);return g.useLayoutEffect(()=>{const p=(t==null?void 0:t.current)||v.current.parent,o=v.current;if(!(p instanceof Yt))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const n={position:new U,rotation:new rt,scale:new U(1,1,1)};if(p){Z(n,{position:i,scale:u});const c=p.matrixWorld.clone();if(p.matrixWorld.identity(),!s||typeof s=="number"){const d=new Zt;d.position.copy(n.position),d.lookAt(p.position),typeof s=="number"&&d.rotateZ(s),Z(n,{rotation:d.rotation})}else Z(n,{rotation:s});return o.geometry=new sn(p,n.position,n.rotation,n.scale),a.current&&Z(a.current,n),p.matrixWorld=c,()=>{o.geometry.dispose()}}},[t,...Ae(i),...Ae(u),...Ae(s)]),g.createElement("mesh",{ref:v},r||g.createElement("meshStandardMaterial",de({transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10},h)),e&&g.createElement("mesh",{ref:a},g.createElement("boxGeometry",null),g.createElement("meshNormalMaterial",{wireframe:!0}),g.createElement("axesHelper",null)))}let be=null;function _t(e,t,r){return i=>{r&&r(i),e&&(be||(be=new an),be.setDecoderPath(typeof e=="string"?e:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),i.setDRACOLoader(be)),t&&i.setMeshoptDecoder(typeof Ce=="function"?Ce():Ce)}}function Et(e,t=!0,r=!0,i){return K(We,e,_t(t,r,i))}Et.preload=(e,t=!0,r=!0,i)=>K.preload(We,e,_t(t,r,i));Et.clear=e=>K.clear(We,e);const ar=g.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:s=!0,onChange:u,onStart:h,onEnd:v,...a},p)=>{const o=q(M=>M.invalidate),n=q(M=>M.camera),c=q(M=>M.gl),d=q(M=>M.events),m=q(M=>M.setEvents),P=q(M=>M.set),y=q(M=>M.get),l=q(M=>M.performance),f=t||n,b=i||d.connected||c.domElement,E=g.useMemo(()=>new ln(f),[f]);return Be(()=>{E.enabled&&E.update()},-1),g.useEffect(()=>(E.connect(b),()=>void E.dispose()),[b,r,E,o]),g.useEffect(()=>{const M=R=>{o(),r&&l.regress(),u&&u(R)},S=R=>{h&&h(R)},A=R=>{v&&v(R)};return E.addEventListener("change",M),E.addEventListener("start",S),E.addEventListener("end",A),()=>{E.removeEventListener("start",S),E.removeEventListener("end",A),E.removeEventListener("change",M)}},[u,h,v,E,o,m]),g.useEffect(()=>{if(e){const M=y().controls;return P({controls:E}),()=>P({controls:M})}},[e,E]),g.createElement("primitive",de({ref:p,object:E,enableDamping:s},a))}),lr=g.forwardRef(({children:e,speed:t=1,rotationIntensity:r=1,floatIntensity:i=1,floatingRange:s=[-.1,.1],...u},h)=>{const v=g.useRef(null),a=g.useRef(Math.random()*1e4);return Be(p=>{var o,n;const c=a.current+p.clock.getElapsedTime();v.current.rotation.x=Math.cos(c/4*t)/8*r,v.current.rotation.y=Math.sin(c/4*t)/8*r,v.current.rotation.z=Math.sin(c/4*t)/20*r;let d=Math.sin(c/4*t)/10;d=Kt.mapLinear(d,-.1,.1,(o=s==null?void 0:s[0])!==null&&o!==void 0?o:-.1,(n=s==null?void 0:s[1])!==null&&n!==void 0?n:.1),v.current.position.y=d*i}),g.createElement("group",u,g.createElement("group",{ref:cn([v,h])},e))});function cr({all:e,scene:t,camera:r}){const i=q(({gl:h})=>h),s=q(({camera:h})=>h),u=q(({scene:h})=>h);return g.useLayoutEffect(()=>{const h=[];e&&(t||u).traverse(p=>{p.visible===!1&&(h.push(p),p.visible=!0)}),i.compile(t||u,r||s);const v=new Jt(128);new Qt(.01,1e5,v).update(i,t||u),v.dispose(),h.forEach(p=>p.visible=!1)},[]),null}export{rr as C,sr as D,lr as F,or as H,ar as O,cr as P,wt as a,Et as b,ir as u};
